# オブジェクト検出比較PoC

YOLO11xを使用したオブジェクト検出と比較のための包括的なWebアプリケーションです。このアプリケーションでは、2つの画像間でオブジェクトを比較し、欠落または追加されたアイテムを特定し、ビデオストリームでリアルタイムオブジェクト検出を実行できます。

![Object Detection Demo](https://img.shields.io/badge/YOLO-11x-blue) ![FastAPI](https://img.shields.io/badge/FastAPI-Latest-green) ![Python](https://img.shields.io/badge/Python-3.8+-yellow)

## 機能

### 🔍 コア検出機能
- **画像の2枚比較**: 2枚の画像をアップロードして、検出されたオブジェクトの違いを特定
- **リアルタイム映像処理**: WebSocketストリーミングを使用したWebカメラによるライブオブジェクト検出
- **高度なYOLO11x統合**: 80以上のオブジェクトクラスを持つ最新のオブジェクト検出技術
- **信頼度閾値制御**: 検出感度の調整可能（0.1 - 1.0）
- **バッチ処理**: 複数の検出パラメータをサポート

### 📊 分析・可視化
- **オブジェクト計数**: クラス別の検出されたオブジェクトの自動計数
- **差分分析**: 画像間の欠落、追加、変更されたオブジェクトを特定
- **視覚的注釈**: 信頼度スコア付きバウンディングボックス
- **比較レポート**: 統計とサマリーを含む詳細分析
- **エクスポート機能**: レポートと注釈付き画像の保存

### 🌐 Web インターフェース
- **モダンUI**: クリーンでレスポンシブなWebインターフェース
- **複数の入力方法**: ファイルアップロード、ドラッグ＆ドロップ、カメラキャプチャ、クリップボード貼り付け
- **リアルタイムプレビュー**: オブジェクト検出オーバーレイ付きライブカメラフィード
- **ネットワークアクセス**: リモートアクセス用のLAN共有機能
- **プログレスインジケータ**: リアルタイム処理状況とフィードバック

## クイックスタート

### 前提条件
- Python 3.8以上
- Webカメラ（オプション、リアルタイム検出用）
- 4GB以上のRAM推奨
- インターネット接続（初回YOLOモデルダウンロード用）

### インストール・起動

#### Windows
```bash
# プロジェクトをクローンまたはダウンロード
cd OD_PoC

# 自動セットアップの実行
run.bat
```

#### Linux/macOS
```bash
# プロジェクトをクローンまたはダウンロード
cd OD_PoC

# スクリプトを実行可能にする
chmod +x run.sh

# 自動セットアップの実行
./run.sh
```

#### 手動インストール
```bash
# 依存関係のインストール
pip install -r requirements.txt

# アプリケーション開始
python app.py
```

### アプリケーションへのアクセス
- **ローカルアクセス**: http://localhost:3000
- **ネットワークアクセス**: LAN共有の手順については http://localhost:3000/network-access をご覧ください

## 使用ガイド

### 1. 画像比較ワークフロー

#### ステップ1: 最初の画像をアップロード
- 「ファイル選択」をクリックするか、最初の画像をドラッグ＆ドロップ
- サポート形式: JPG、PNG、JPEG
- または、カメラキャプチャ・クリップボードから貼り付けを使用

#### ステップ2: 2番目の画像をアップロード
- サポートされている任意の方法で2番目の画像をアップロード
- 両方の画像が処理されると、システムが自動的に比較を有効化

#### ステップ3: 結果の確認
- バウンディングボックス付きで検出されたオブジェクトを表示
- 違いを示す比較表を確認
- 欠落・追加オブジェクトの統計分析

#### ステップ4: パラメータ調整（オプション）
- 信頼度閾値の微調整（デフォルト: 0.15）
- 重複検出用IoU閾値の変更
- 最大検出数制限の調整

#### ステップ5: 結果のエクスポート
- 注釈付き画像のダウンロード
- 詳細レポートのエクスポート
- 比較データの保存

### 2. ネットワーク共有
1. `/network-access`エンドポイントにアクセス
2. 提供されたIPアドレスをネットワーク上の他のデバイスと共有
3. 同一ネットワーク上の任意のデバイスからアプリケーションにアクセス

## 技術詳細

### オブジェクト検出クラス
YOLO11xモデルは以下を含む80以上のオブジェクトクラスを検出します：
- **人・動物**: person（人）、cat（猫）、dog（犬）、horse（馬）、bird（鳥）など
- **乗り物**: car（車）、truck（トラック）、bus（バス）、motorcycle（オートバイ）、bicycle（自転車）など
- **家庭用品**: chair（椅子）、table（テーブル）、bed（ベッド）、couch（ソファ）、tv（テレビ）など
- **食べ物・飲み物**: apple（りんご）、banana（バナナ）、cup（カップ）、bottle（ボトル）など
- **電子機器**: laptop（ノートPC）、phone（電話）、keyboard（キーボード）、mouse（マウス）など
- **スポーツ用品**: ball（ボール）、racket（ラケット）、skateboard（スケートボード）など

### APIエンドポイント

#### メインエンドポイント
- `GET /` - メインアプリケーションインターフェース
- `POST /detect/{image_number}` - アップロードされた画像の処理（1または2）
- `POST /detect-base64/{image_number}` - base64エンコードされた画像の処理
- `POST /compare` - 2つの処理済み画像の比較
- `POST /adjust-parameters` - 新しいパラメータでの再分析
- `GET /status` - 現在のワークフロー状況取得

#### ユーティリティエンドポイント
- `GET /health` - ヘルスチェックとモデル状況
- `GET /network-access` - ネットワーク共有ガイド
- `POST /reset-workflow` - 現在のセッションクリア
- `POST /save-results` - 結果エクスポート

#### WebSocket
- `WS /ws/video/{client_id}` - リアルタイム映像処理

### 設定オプション

#### 検出パラメータ
```python
# 調整可能パラメータ
conf_threshold: float = 0.15    # 信頼度閾値（0.1 - 1.0）
iou_threshold: float = 0.45     # NMS用IoU閾値
max_detection: int = 500        # 画像あたりの最大検出数
```

#### モデル設定
- **モデル**: YOLO11x（yolo11x.pt）
- **入力サイズ**: 640px（調整可能）
- **処理**: 精度と速度の両方に最適化
- **クラス**: COCOデータセット80クラス

## ファイル構造

```
OD_PoC/
├── app.py                  # メインFastAPIアプリケーション
├── requirements.txt        # Python依存関係
├── yolo11x.pt             # YOLO11xモデルファイル
├── run.bat                # Windows起動スクリプト
├── run.sh                 # Linux/macOS起動スクリプト
├── instruction.md         # 開発仕様
├── quick_test.md         # テストガイド
├── certs/                # SSL証明書（必要に応じて）
├── static/               # 静的Webアセット
│   ├── css/style.css    # アプリケーションスタイル
│   └── js/app.js        # フロントエンドJavaScript
└── templates/           # HTMLテンプレート
    ├── index.html       # メインアプリケーションインターフェース
    └── network_access.html # ネットワーク共有ガイド
```

## システム要件

### 最小要件
- **CPU**: 4コア以上推奨
- **RAM**: 最小4GB、8GB推奨
- **ストレージ**: 2GBの空き容量（モデルファイル用）
- **GPU**: オプション（高速処理用CUDA対応）

### 推奨環境
- **Python**: 3.9以上
- **プラットフォーム**: Windows 10以上、Ubuntu 20.04以上、macOS 11以上
- **ブラウザ**: WebRTCサポートのモダンブラウザ
- **ネットワーク**: 初回モデルダウンロード用の安定したインターネット接続

## トラブルシューティング

### よくある問題

#### モデル読み込みエラー
```bash
# YOLOモデルの再ダウンロード
pip install ultralytics --upgrade
python -c "from ultralytics import YOLO; YOLO('yolo11x.pt')"
```

#### ポートが既に使用中
- `app.py`の747行目のポート番号を変更: `port=3000`を別のポートに変更
- または、そのポートを使用している既存のプロセスを終了

#### カメラアクセス拒否
- ブラウザのカメラアクセス許可を確認
- 他のアプリケーションがカメラを使用していないことを確認
- ページを更新してカメラアクセスを許可

#### メモリ問題
- `max_detection`パラメータを減らす
- アップロード前に画像解像度を下げる
- 他のメモリ集約的なアプリケーションを閉じる

### パフォーマンス最適化
- 利用可能な場合はGPUアクセラレーションを使用
- 高速処理のために画像サイズを削減
- 速度・精度バランスのために信頼度閾値を調整
- 速度重視の場合は小さなYOLOモデル（yolo11x.ptの代わりにyolo11n.pt）を使用

## 貢献

これは概念実証プロジェクトです。改善や問題については：
1. アプリケーションを徹底的にテスト
2. バグや機能要求を文書化
3. パフォーマンス最適化を検討
4. 異なるプラットフォーム間での互換性を確保

## ライセンス

このプロジェクトはデモンストレーション・教育目的のためのものです。商用利用の場合は、YOLOおよび依存関係のライセンスへの準拠を確実にしてください。

## バージョン履歴

- **v1.0.0** - デュアル画像比較機能付き初回リリース
- **v1.1.0** - リアルタイム映像処理追加（このバージョンには未含）
- **v1.2.0** - ネットワーク共有機能強化
- **現在** - パフォーマンス最適化と検出クラス拡張

---

技術サポートや実装に関する質問については、`instruction.md`ファイルを参照するか、`quick_test.md`を使用してアプリケーションをテストしてください。
