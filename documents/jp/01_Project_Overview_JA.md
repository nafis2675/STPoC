# オブジェクト検出ウェブアプリケーション - プロジェクト概要

## 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [主要機能](#主要機能)
3. [技術スタック](#技術スタック)
4. [システムアーキテクチャ](#システムアーキテクチャ)
5. [使用事例](#使用事例)
6. [パフォーマンス特性](#パフォーマンス特性)
7. [セキュリティ考慮事項](#セキュリティ考慮事項)

## プロジェクト概要

オブジェクト検出ウェブアプリケーションは、YOLO11x（You Only Look Once）深層学習モデルを中心とした包括的なリアルタイム コンピュータビジョン ソリューションです。このアプリケーションは、直感的なWebインターフェースを通じて静的画像分析とライブビデオ処理機能の両方を提供します。

### 主要目的
- **画像比較**: 2つの画像間でオブジェクトを検出・比較し、変化を識別
- **リアルタイム検出**: カメラフィードを使用したライブオブジェクト検出と追跡
- **在庫管理**: 在庫追跡のための時系列オブジェクト変化監視
- **Webベースインターフェース**: 最新のウェブブラウザを持つ任意のデバイスからアクセス可能

### 対象ユーザー
- **品質管理チーム**: 製造における前後画像比較
- **在庫管理者**: リアルタイムの在庫変化追跡
- **セキュリティ担当者**: ビデオフィードによるエリア変化監視
- **研究者**: オブジェクト検出性能と精度の分析
- **開発者**: コンピュータビジョン実装パターンの学習

## 主要機能

### 1. デュアル画像比較モード
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   画像 1    │────│  検出分析   │────│  比較レポート│
│  アップロード│    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
        │                 │                 │
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   画像 2    │────│  検出分析   │────│  欠落/追加  │
│  アップロード│    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
```

**特徴:**
- 複数の入力方法（アップロード、カメラ撮影、クリップボード貼り付け）
- 調整可能な検出パラメータ（信頼度、IoU、最大検出数）
- バウンディングボックス付きの視覚的オブジェクト注釈
- オブジェクトの差異を示す詳細比較レポート
- 結果と注釈付き画像のエクスポート機能

### 2. リアルタイムビデオ検出
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  カメラ     │────│   YOLO11x   │────│ リアルタイム│
│  ストリーム │    │    検出     │    │  オーバーレイ│
└─────────────┘    └─────────────┘    └─────────────┘
        │                 │                 │
        │                 ▼                 ▼
        │         ┌─────────────┐    ┌─────────────┐
        └────────►│ WebSocket   │────│ ライブ統計  │
                  │   処理      │    │ ダッシュボード│
                  └─────────────┘    └─────────────┘
```

**特徴:**
- ライブカメラフィード処理
- リアルタイムオブジェクト検出オーバーレイ
- 低遅延のためのWebSocketベース通信
- パフォーマンス統計（FPS、オブジェクト数、ユニーククラス数）
- スクリーンショット撮影機能

### 3. 在庫追跡システム
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ ベースライン │────│  現在検出   │────│  変化分析   │
│   キャプチャ │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
        │                 │                 │
        ▼                 ▼                 ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ オブジェクト │    │ リアルタイム │    │ タイムライン │
│   在庫      │    │   監視      │    │  レポート   │
└─────────────┘    └─────────────┘    └─────────────┘
```

**特徴:**
- ベースラインオブジェクト状態の確立
- リアルタイム変化監視
- 欠落/追加アイテムアラート
- 詳細追跡タイムライン
- ダウンロード可能な在庫レポート

## 技術スタック

### バックエンド技術
```yaml
コアフレームワーク:
  - FastAPI: ">=0.100.0"
  - Uvicorn: ">=0.20.0" (ASGIサーバー)
  - Python-multipart: ">=0.0.5" (ファイルアップロード)

コンピュータビジョン:
  - Ultralytics: ">=8.0.0" (YOLO11x実装)
  - OpenCV: ">=4.8.0" (画像処理)
  - Pillow: ">=10.0.0" (画像操作)

深層学習:
  - PyTorch: ">=2.0.0" (ニューラルネットワークフレームワーク)
  - Torchvision: ">=0.15.0" (コンピュータビジョンモデル)
  - Torchaudio: ">=2.0.0" (音声処理)

データ処理:
  - NumPy: ">=1.21.0" (数値計算)
  - Collections: Counter (オブジェクト数)

ウェブ技術:
  - Jinja2: ">=3.0.0" (HTMLテンプレート)
  - WebSockets: リアルタイム通信
  - Static Files: CSS/JS/画像配信
```

### フロントエンド技術
```yaml
コア技術:
  - HTML5: セマンティックマークアップと構造
  - CSS3: Flexbox/Gridによるレスポンシブデザイン
  - Vanilla JavaScript: ES6+機能

UIライブラリ:
  - Font Awesome: "6.4.0" (アイコン)
  - カスタムCSS: グラデーションベースの現代的デザイン

ブラウザAPI:
  - MediaDevices API: カメラアクセス
  - WebSocket API: リアルタイム通信
  - Canvas API: 画像処理とオーバーレイ
  - Clipboard API: 画像貼り付け機能
  - File API: ドラッグアンドドロップアップロード
```

### インフラストラクチャコンポーネント
```yaml
セッション管理:
  - UUIDベースのセッションID
  - スレッドセーフなセッションストレージ
  - 自動クリーンアップ（24時間期限）

リアルタイム処理:
  - クライアント毎のWebSocket接続
  - フレーム処理キュー
  - 最適化された検出パラメータ

ネットワーク設定:
  - マルチインターフェースIP検出
  - LAN共有機能
  - HTTPS/HTTPプロトコル処理
```

## システムアーキテクチャ

### 高レベルアーキテクチャ
```
┌─────────────────────────────────────────────────────────┐
│                   ウェブブラウザ                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  HTML/CSS   │  │ JavaScript  │  │  WebSocket  │    │
│  │   UI層      │  │   ロジック  │  │  クライアント│    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
                           │
                    HTTP/WebSocket
                           │
┌─────────────────────────────────────────────────────────┐
│                  FastAPIサーバー                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   HTTP      │  │  WebSocket  │  │  セッション │    │
│  │ エンドポイント│  │  ハンドラー │  │  マネージャー│    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
                           │
                      モデル層
                           │
┌─────────────────────────────────────────────────────────┐
│               オブジェクト検出サービス                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   YOLO11x   │  │   OpenCV    │  │    PIL      │    │
│  │   モデル    │  │   処理      │  │  画像操作   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────┘
```

### コンポーネント相互作用

#### 1. セッションベースアーキテクチャ
```python
class SessionManager:
    sessions = {}  # session_id -> session_data
    
    # スレッドセーフ操作
    def create_session() -> str
    def get_session(session_id) -> Dict
    def update_session(session_id, key, value)
    def cleanup_old_sessions(max_age_hours=24)
```

#### 2. 検出サービスパイプライン
```python
class ObjectDetectionService:
    def load_model()                    # YOLO11x初期化
    def detect_objects()                # 推論実行
    def analyze_detections()            # 結果処理
    def create_detection_report()       # レポート生成
    def compare_images()                # 2つの画像比較
    def process_video_frame()           # リアルタイム処理
```

#### 3. リアルタイムビデオパイプライン
```python
class VideoProcessingManager:
    active_connections = {}  # client_id -> WebSocket
    
    def connect(websocket, client_id)
    def send_detection_result(client_id, result)
    def disconnect(client_id)
```

### データフロー図

#### 画像比較ワークフロー
```
ユーザー入力 → ファイルアップロード/カメラ/貼り付け
     ↓
Base64エンコード → 画像検証
     ↓
YOLO検出 → オブジェクト分析
     ↓
セッション保存 → 結果表示
     ↓
2番目画像 → 同じプロセス
     ↓
比較ロジック → レポート生成
```

#### リアルタイムビデオワークフロー
```
カメラストリーム → Canvasレンダリング
     ↓
フレーム抽出 → WebSocket送信
     ↓
サーバー処理 → YOLO検出
     ↓
結果返却 → オーバーレイ描画
     ↓
パフォーマンス統計 → UI更新
```

## 使用事例

### 1. 製造品質管理
**シナリオ**: 組立前後の製品比較
```
前画像: 組立ライン上の生部品
後画像: 完成製品
分析: 欠落部品や組立エラーの検出
```

### 2. 在庫管理
**シナリオ**: 倉庫在庫変化の追跡
```
ベースライン: 全製品を含む初期棚状態
監視: アイテム除去/追加のリアルタイム検出
レポート: 在庫変化レポートの生成
```

### 3. セキュリティ監視
**シナリオ**: 制限区域の不正アイテム監視
```
ベースライン: 清潔な制限区域
監視: 新オブジェクトのリアルタイム検出
アラート: 変化の即座通知
```

### 4. 小売分析
**シナリオ**: 製品との顧客インタラクション分析
```
前: フル製品ディスプレイ
後: 顧客インタラクション期間
分析: 移動・取得された製品の識別
```

## パフォーマンス特性

### 検出精度
```yaml
モデル: YOLO11x
クラス: COCOデータセット80オブジェクト
信頼度範囲: 0.05 - 0.95（調整可能）
IoU閾値: 0.1 - 0.9（調整可能）
最大検出: 画像当たり10 - 2000

典型的パフォーマンス:
  - 高精度オブジェクト: 人、車、椅子（>90%）
  - 中精度オブジェクト: ボトル、本、携帯電話（70-90%）
  - 困難オブジェクト: 小アイテム、部分遮蔽（50-70%）
```

### 処理パフォーマンス
```yaml
画像処理:
  - 静的画像: 1-3秒（サイズと複雑さによる）
  - リアルタイムビデオ: 約5 FPS処理、30 FPS表示
  - 比較分析: 結果まで1秒未満

メモリ使用量:
  - ベースアプリケーション: 約200MB
  - YOLOモデル読み込み: 追加500MB
  - セッション毎ストレージ: 画像により10-50MB

ネットワーク要件:
  - 画像アップロード: 画像サイズによる（通常1-10MB）
  - WebSocket: 座標/メタデータの低帯域幅
  - LANアクセス: 複数同時ユーザーサポート
```

### スケーラビリティ制限
```yaml
同時ユーザー数:
  - 画像比較: 10-20ユーザー（メモリ依存）
  - ビデオ処理: 2-5ユーザー（CPU/GPU依存）
  - 混合使用: リソース配分により変動

セッション管理:
  - 24時間後自動クリーンアップ
  - エンドポイント経由での手動クリーンアップ可能
  - 同時アクセスのスレッドセーフ操作
```

## セキュリティ考慮事項

### データプライバシー
```yaml
画像ストレージ:
  - 処理中の一時的インメモリストレージ
  - サーバー上の永続ファイルストレージなし
  - セッション期限時の自動クリーンアップ
  - ログに画像データなし

ネットワークセキュリティ:
  - 本番環境ではHTTPS推奨
  - モバイルカメラアクセスにはセキュアコンテキスト必要
  - ローカルネットワーク共有ガイドライン提供
```

### アクセス制御
```yaml
認証:
  - セッションベース分離
  - ユーザーアカウント不要
  - 各セッションは独立してセキュア

APIセキュリティ:
  - 全操作でセッションID検証
  - アップロードのファイルタイプ検証
  - アップロードサイズ制限
  - レート制限考慮事項
```

### デプロイメントセキュリティ
```yaml
本番考慮事項:
  - カメラアクセスにHTTPS使用
  - LANアクセスのファイアウォール設定
  - 依存関係の定期セキュリティ更新
  - 分離のためのコンテナ化検討
```

---

この文書はオブジェクト検出ウェブアプリケーションの包括的概要を提供します。詳細なセットアップ手順については、インストールガイドを参照してください。技術実装詳細については、アーキテクチャドキュメントを参照してください。
